#:kivy 1.10.0
#:import Factory kivy.factory.Factory

<Manager>:
    MainW:
        name: 'main'
    Chat:
        name: 'chat'
    Stgs:
        name: 'settings'

<MyPopup@ModalView>:
    size_hint: None, None
    size: 300, 200
    background_color: 0.4, 0.4, 0.4, 0.5
    BoxLayout:
        orientation: 'vertical'
        padding: 15, 15, 15, 15
        cols: 2
        Label:
            color: 0.7, 0, 0, 0.9
            center_x: root.center_x
            center_y: root.center_y
            text: 'Are you sure you want to exit?'
        BoxLayout:
            size_hint: 1, 0.4
            Button:
                color: 0.7, 0, 0, 0.9
                background_color: 0.4, 0.4, 0.4, 0.1
                text: 'Yes'
                on_release: exit()
            Button:
                color: 0.7, 0, 0, 0.9
                background_color: 0.4, 0.4, 0.4, 0.1
                text: 'No'
                on_release: root.dismiss()

<MainW>:
    Button:
        id: bck
        background_down: './icons/back-press.png'
        background_normal: './icons/back.png'
        border: 0, 0, 0, 0
        x: root.x + 20
        top: root.top - 10
        size: 40, 40
        size_hint: None, None
        on_release: Factory.MyPopup().open()
    
    Button:
        id: stgs
        background_down: './icons/settings-press.png'
        background_normal: './icons/settings.png'
        border: 0, 0, 0, 0
        right: root.right - 20
        top: root.top - 10
        size: 40, 40
        size_hint: None, None
        on_release:
            app.lastscreen = root.manager.current
            root.manager.transition.direction = 'down'
            root.manager.current = 'settings'

    Button:
        id: mcphne
        background_down: './icons/microphone-press.png'
        background_normal: './icons/microphone.png'
        border: 0, 0, 0, 0
        center_x: root.width / 2
        y: root.y + 40
        size: 50, 50
        size_hint: None, None

    Button:
        id: msg
        background_down: './icons/msg-press.png'
        background_normal: './icons/msg.png'
        border: 0, 0, 0, 0
        center_x: root.right - 50
        y: root. y + 45
        size: 30, 30
        size_hint: None, None
        on_release:
            root.manager.transition.direction = 'up'
            root.manager.current = 'chat'

<Chat>:
    Button:
        id: bck
        background_down: './icons/back-press.png'
        background_normal: './icons/back.png'
        border: 0, 0, 0, 0
        x: root.x + 20
        top: root.top - 10
        size: 40, 40
        size_hint: None, None
        on_release:
            root.manager.transition.direction = 'down'
            root.manager.current = 'main'

    Button:
        id: stgs
        background_down: './icons/settings-press.png'
        background_normal: './icons/settings.png'
        border: 0, 0, 0, 0
        right: root.right - 20
        top: root.top - 10
        size: 40, 40
        size_hint: None, None
        on_release:
            app.lastscreen = root.manager.current
            root.manager.transition.direction = 'down'
            root.manager.current = 'settings'

    BoxLayout:
        orientation: 'horizontal'
        padding: 10, 10, 10, 10
        cols: 2
        Image:
            id: inpimg
            source: './icons/user_inp1.png'
            x: root.x + 10
            y: root.y + 10
            width: root.width - 40
            height: max(40, scrlv.height)
            size_hint: 0.9, None
            allow_stretch: True
            keep_ratio: False
            ScrollView:
                id: scrlv
                x: root.ids['inpimg'].x + 10
                y: root.ids['inpimg'].y
                width: inpimg.width - 15
                height: (len(usrinp._lines)+1) * usrinp.line_height if (len(usrinp._lines)+1 <= 5) else 5 * usrinp.line_height
                TextInput:
                    id: usrinp
                    valign: 'middle'
                    halign: 'left'
                    font_size: 16
                    multiline: True
                    size_hint: scrlv.size_hint_x, None
                    height: scrlv.height
                    background_color: 0, 0, 0, 0
    
        Button:
            id: post
            foreground_color: 0, 0, 0, 0
            background_down: './icons/type1-press.png'
            background_normal: './icons/type1.png'
            border: 0, 0, 0, 0
            size: 35, 35
            x: inpimg.x + 10
            y: root.y + 20
            size_hint: None, None
            on_release:
                usrinp.text = ''
<Stgs>:
    canvas:
        Rectangle:
            pos: self.x, 0
            size: self.width, self.height
    Button:
        id: bck
        background_down: './icons/back-press.png'
        background_normal: './icons/back.png'
        border: 0, 0, 0, 0
        x: root.x + 20
        top: root.top - 10
        size: 40, 40
        size_hint: None, None
        on_release:
            root.manager.transition.direction = 'up'
            root.manager.current = app.lastscreen

    Label:
        center_x: self.center_x
        center_y: self.center_y
        text: 'The settings menu'
        color: 1, 0, 0, 1

        
